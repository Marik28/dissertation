# Диаграммы последовательностей

## Обобщенная последовательность работы приложения

```mermaid
sequenceDiagram
    autonumber
    participant Пользователь
    participant Программа
    participant БД
    participant Плата
    participant ТРМ
    Пользователь ->> Программа: Выбрать датчик
    Программа ->> БД: Найти характеристику датчика
    БД -->> Программа: Вернуть характеристику датчика
    Программа -->> Пользователь: Отобразить характеристику датчика
    Программа ->> Плата: Переключить реле
    loop Несколько раз в секунду
        Программа ->> Плата: Расcчитать температуру и отправить код
        Плата ->> ТРМ: Выработать сигнал
        Программа ->> ТРМ: Опросить параметры ТРМ-а
        ТРМ -->> Программа: Вернуть запрошенные параметры
        Программа -->> Пользователь: Перерисовать графики и отобразить параметры
    end
```

## Последовательность чтения параметров ТРМ

```mermaid
sequenceDiagram
    autonumber
    participant Пользователь
    participant TemperaturePlotManager
    participant TRMParametersInfoTable
    participant TRMParametersReadThread
    participant OwenClient
    participant ТРМ

    loop
        TRMParametersReadThread ->> OwenClient : запросить параметры
    loop на каждый параметр
        OwenClient ->> ТРМ : запросить параметр
        ТРМ -->> OwenClient : вернуть запрошенный параметр
    end
    OwenClient -->> TRMParametersReadThread : вернуть запрошенные параметры
    TRMParametersReadThread ->> TRMParametersInfoTable : обновить значение параметров
    TRMParametersInfoTable ->> Пользователь : отобразить параметры
    TRMParametersReadThread ->> TemperaturePlotManager : обновить измеренную температуру  
    TemperaturePlotManager ->> Пользователь : обновить график
    end
```

## Последовательность расчета температуры

```mermaid
sequenceDiagram
    autonumber
    participant Пользователь
    participant TemperaturePlotManager
    participant TemperatureCalculationThread
    participant Solver
    participant SensorManager
    participant Device
    participant Интерфейсная плата
    participant ТРМ

    loop
        TemperatureCalculationThread ->> Solver : запросить рассчитанную температуру
        Solver -->> TemperatureCalculationThread : вернуть рассчитанную температуру 
        TemperatureCalculationThread ->> TemperaturePlotManager : отобразить температуру
        TemperaturePlotManager ->> Пользователь : обновить график
        TemperatureCalculationThread ->> SensorManager : установить рассчитанную температуру
        SensorManager ->> Device : отправить код
        Device ->> Интерфейсная плата : отправить код по шине
        Интерфейсная плата ->> ТРМ : выработать электрический сигнал
    end
```